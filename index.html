<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="后台服务开发" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="后台服务开发">
<meta property="og:url" content="http://www.servercoder.com/index.html">
<meta property="og:site_name" content="后台服务开发">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="后台服务开发">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6378769802097329000,
      author: 'Richardor'
    }
  };
</script>

  <title> 后台服务开发 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">后台服务开发</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/03/27/envoy-grpc-not-nginx/" itemprop="url">
                  nginx也许并不是service mesh最好的选择，envoy才是
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-03-27T20:25:50+08:00" content="2018-03-27">
              2018-03-27
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/03/27/envoy-grpc-not-nginx/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/03/27/envoy-grpc-not-nginx/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>前几天好几个公众号推送了这样一篇文章：《Service Mesh利器：NGINX将支持gRPC》，更有甚者鼓吹nginx是第一个支持grpc的代理。看到这几篇文章的时候，我总想说点关于国内的互联网发展。</p>
<p>这几年国内互联网行业变化飞快。先是微服务，当时国内各大线下交流会议都是各种微服务框架的分享，比如zookeeper采坑之类，微服务的十二要素啊，服务治理什么的。然后接着就是直播行业，这时线下会议又变成了视频秒开啊，如何连麦啊，cdn优化啊等等。不仅技术从业者都往这上面冲，各大投资者也是一个劲地往里砸钱，都不想错过这个风口。到去年，又有人开始鼓吹直播已死。这个时候听到更多的一个词又是devops，这个时候，可能听到的更多就是全链路监控告警，apm优化，devops实践等等。到了今年，情况就更夸张了，kubernetes、区块链、人工智能，尤其是区块链，只要上市公司有一点区块链概念沾边，估价就蹭蹭蹭地网上涨停，比如迅雷、人人网。接下来只怕是公司有一点人工智能的概念，那也会不得了。到今年年末明年年初，我断定，service mesh又肯定会成为各大线下会议的主要课题。</p>
<p>百花齐放固然是好，但技术的革新不可能如此的快。著名的一万小时理论告诉我们，如果要精通一门技术，一年的时间是远远不够的。我觉得国内互联网氛围有点浮躁了，这不好，尤其是对刚毕业的年轻人。</p>
<h2 id="什么是grpc"><a href="#什么是grpc" class="headerlink" title="什么是grpc"></a>什么是grpc</h2><blockquote>
<p>gRPC is a modern open source high performance RPC framework that can run in any environment. It can efficiently connect services in and across data centers with pluggable support for load balancing, tracing, health checking and authentication. It is also applicable in last mile of distributed computing to connect devices, mobile applications and browsers to backend services.</p>
</blockquote>
<p>简单点说，grpc就是谷歌出的rpc框架，数据交换格式基于protobuf，数据传输基于http2。谷歌提供了大部分常用语言的sdk。</p>
<h2 id="grpc代理选择：envoy"><a href="#grpc代理选择：envoy" class="headerlink" title="grpc代理选择：envoy"></a>grpc代理选择：envoy</h2><p>我有幸参与了一个grpc的项目，当时版本还是的0.x。说句题外话，如果是我负责选型，我断不会轻易同意将不稳定的第三方软件应用到产品里，就是非用不可，也一定要深入了解它才行。我踩过太多这样的坑了。</p>
<p>当时为了做grpc的负载均衡，我特地仔细研究过grpc的官方文档，google的开发人员提到了nghttpx和envoy这两种代理。</p>
<p>nghttpx是一个基于nghttp2的代理，nghttp2是一个http2的库，前面提到grpc本质是基于http2的通信，所以要想做grpc的代理，必须要底层要能支持http2，这也是为什么最近发布的nginx1.13才支持代理grpc的原因，因为nginx老版本并不支持http2协议。</p>
<p>要想做好grpc的负载均衡，只是支持http2协议还不够，必须要有基本的负载均衡算法，比如，我们的应用是根据请求的信息，调度到不同的服务器上。要想实现这样的功能，就必须基于python或其他脚本语言配置。</p>
<p>而envoy在这一方面就强多了，它支持多种负载均衡算法：Round robin、Weighted least request、ring hash、Maglev、Random、Original destination。对于我上面提到的例子，只需要将请求的字段放如grpc的context中，然后配置envoy时根据该字段设置好server的ring hash就行，几句配置就搞定了。</p>
<p>当然，envoy的强大并不仅仅局限在负载均衡算法多样。它还有如下优点:</p>
<ol>
<li>开源，基于Modern C++11</li>
<li>支持三层、四层、七层代理，支持http路由</li>
<li>支持服务发现、健康检查。</li>
<li>支持mongodb、dynamodb</li>
<li>多种负载均衡算法</li>
<li>动态配置。nginx并不支持哦。</li>
</ol>
<p>这些功能都是开源免费的，但nginx可并不一定，很多进阶功能都需要购买使用nginx plus。</p>
<p>关于健康检查我多说一句，很多平台的健康检查就是检查某个http接口是否有响应，或是tcp连接是否建立，但这并不代表服务功能正常，这就跟单独开线程做心跳是一个道理，envoy支持数据能正常收发层面的健康检查。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>所以，nginx注定了并不是service mesh的最好选择，因为envoy比它提供了更丰富的功能。不过依然可能会有很多公司使用nginx，因为nginx的运维技术相对成熟，网上资料大把。</p>
<p>google、ibm公司还基于envoy弄了一套service mesh的框架Istio，有空我再介绍介绍istio。</p>
<hr>
<p>本文链接：<a href="http://www.servercoder.com/2018/03/27/envoy-grpc-not-nginx/">http://www.servercoder.com/2018/03/27/envoy-grpc-not-nginx/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/03/11/leanote-private/" itemprop="url">
                  基于开源leanote打造多终端同步云笔记应用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-03-11T15:47:05+08:00" content="2018-03-11">
              2018-03-11
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/03/11/leanote-private/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/03/11/leanote-private/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>写在前面，这并不是一篇leanote的广告。</p>
</blockquote>
<p>这些年，我试用过多款云笔记产品，作为一个程序员，我的需求很简单，支持markdown、多终端（windows+mac）同步，界面不要太丑，免费，偶尔导出到pdf。<br>但就是这么简单的需求，似乎很难满足。</p>
<p>市面上我所知道的云笔记产品有：有道云笔记、Evernote、Quiver、Quip、马克飞象， 当然还有人直接使用markdown编辑器，每次保存时，手动或自动推送到github上。</p>
<p>下面说说这些软件或多或少让我不太满意的地方：</p>
<ol>
<li>EverNote确实是名气最大的笔记软件，但重在收集，一直也不支持markdown。</li>
<li>有道云笔记在我开始使用的时候，就丑的不能再丑，写这篇文章的时候特地重新使用了一下，交互比几年前清爽多了，也支持mardown，就是免费版带广告，不能导出文档。</li>
<li>Quiver是我见过的支持的写markdown最舒服，交互最爽的mac版本地笔记软件，就是没有windows版，也不能同步，只能说遗憾了。mac版收费，你知道怎么免费使用的。</li>
<li>Quip支持多终端，没有使用限制，交互简单，能导出文档，能多终端同步。如果不是因为markdown需求，我是不可能抛弃使用了半年的Quip的</li>
<li>本地编辑，利用github的public repository做同步，确实够灵活，就是没有了隐私，尤其是设计到机密的文档，一定要慎重。</li>
</ol>
<h2 id="leanote功能"><a href="#leanote功能" class="headerlink" title="leanote功能"></a>leanote功能</h2><p>有一天，我突然在开源中国上见到了leanote，当时还没有稳定，只要推广用户就能增加一个月的旗舰会员。使用下来后发现，它竟然满足了我所有的需求：markdown、多终端同步、无限制历史记录、免费、能导出到各种文档。各重要的是，开源！</p>
<p>后来发现leanote并不支持使用markdown画流程图、时序图等后，一度想换掉，万幸leanote的开发人员集成了这些图表功能，得给他们点个赞。</p>
<p>当然，leanote也有缺点，我身边很多人不想用的原因也很直接，界面丑！说实在，如果不是实在没有别适合我的软件，我也不太想用leanote的。</p>
<p>此外，leanote还支持一键发布到博客，对于那些懒得自己搭建博客的同学来说，简直就是太方便了。</p>
<h2 id="如何免费用leanote"><a href="#如何免费用leanote" class="headerlink" title="如何免费用leanote"></a>如何免费用leanote</h2><p>使用leanote一年多了，现在没有了leanote旗舰会员，如果要想使用旗舰套餐，每年得给leanote贡献150元，说实在，我觉得这个定价有点贵。<br>既然leanote是开源的，正好我手上又有服务器，那就私有化部署咯。</p>
<p>只要leanote不告我，我承诺3年内不关服，毕竟我自己也要一直使用嘛。blog.servercoder.com，有需要的同学可以自行注册使用。</p>
<hr>
<p>本文链接：<a href="http://www.servercoder.com/2018/03/11/leanote-private/">http://www.servercoder.com/2018/03/11/leanote-private/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/01/10/protobuf-usages/" itemprop="url">
                  你真的用对protobuf了吗？
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-01-10T22:24:54+08:00" content="2018-01-10">
              2018-01-10
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/01/10/protobuf-usages/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/01/10/protobuf-usages/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="历史"><a href="#历史" class="headerlink" title="历史"></a>历史</h2><p>进程间数据交换有很多种方式，比如共享内存、网络通信、文件、数据库等等。如果你的数据并不是整齐有规律，且内存对齐的。大部分情况下，你都需要采用一种数据交换格式来描述你交换的数据，我们通常称之为序列化和反序列化。而描述这些数据的格式，我们通常称之为数据交换格式。</p>
<p>最原始的数据交换格式就类似于tcp/ip那样的描述，一般称之为二进制数据格式。每一层协议都有包头和包体，包头中会包含包体的长度，数据类型，保留字段dengdeng。当然，不要忘了还有块存储区域保存了数据的校验和。尽管这种格式可读性较差，但这种格式的序列化和反序列化效率是最高的。</p>
<p>二进制数据格式除了可读性较差以外，扩展性不好是开发者不会普遍采用的主要原因。于是就慢慢发展出了xml和json这两种自描述的数据交换格式。他们可读性强，有确定的schema。起先http的通信大部分基于soap协议，而soap离不开xml。随着前端技术的发展，尤其是javascript对json的支持，使得开发人员能很方便地序列化和反序列化json，于是json慢慢就成了web开发主流的数据交换格式。如今基本很少看到基于xml的接口了，除了部分陈旧的天气预报服务的订阅接口以外。</p>
<h2 id="为什么选择protobuf"><a href="#为什么选择protobuf" class="headerlink" title="为什么选择protobuf"></a>为什么选择protobuf</h2><p>近几年，又陆续出现了二进制数据交换格式，比如Thrift、Protobuf，还有各大互联网公司自研的号称比protobuf更好的数据交换格式。其中，protobuf封装性更好，与平台语言都无关，使用会更广泛。</p>
<p>除了rest接约定俗称采用json以外，我们大部分采用protobuf的原因如下：</p>
<ol>
<li>速度更快</li>
<li>空间更小</li>
<li>浮点数的精度支持不好，尤其是json</li>
<li>xml、json都是文本型的，如果想存储二进制数据，必须先将其转为文本数据，比如使用base64编码</li>
<li>安全。json不同语言有各种各样的解析库，代码实现者信息安全经验良莠不齐，大部分库都有远程执行漏洞。而protobuf由谷歌官方维护，能很大程度上保证安全，一旦出现安全隐患也会很快更新。</li>
</ol>
<p>大部分人只知道前面两点，并不了解后面三点protobuf的优势。</p>
<h2 id="protobuf你用对了吗？"><a href="#protobuf你用对了吗？" class="headerlink" title="protobuf你用对了吗？"></a>protobuf你用对了吗？</h2><h3 id="尽量使用proto3"><a href="#尽量使用proto3" class="headerlink" title="尽量使用proto3"></a>尽量使用proto3</h3><p>相比于proto2，proto3更简洁，不需要用户指定required、optional关键字，这点除了开发更方便以外，对于前后兼容也是非常有帮助的，我将在下一条建议中说明。</p>
<h2 id="版本号"><a href="#版本号" class="headerlink" title="版本号"></a>版本号</h2><p>有很多从json或其他协议转过来的人，还会保留以前那套协议版本号的做法。事实上，这样的做法非常恶心，代码里面会有大量的版本判断和处理。protobuf的设计初衷就是为了避免出现这样恶心的代码的。<br>具体请看<a href="https://developers.google.com/protocol-buffers/docs/overview#a-bit-of-history" target="_blank" rel="external">a bit of history</a>、<a href="https://developers.google.com/protocol-buffers/docs/cpptutorial#extending-a-protocol-buffer" target="_blank" rel="external">Extending a Protocol Buffer</a></p>
<p>谷歌是这样讲的:</p>
<blockquote>
<p>Protocol buffers were designed to solve many of these problems:</p>
<p>New fields could be easily introduced, and intermediate servers that didn’t need to inspect the data could simply parse it and pass through the data without needing to know about all the fields.</p>
<p>Formats were more self-describing, and could be dealt with from a variety of languages (C++, Java, etc.)</p>
</blockquote>
<h2 id="存储大量字符串"><a href="#存储大量字符串" class="headerlink" title="存储大量字符串"></a>存储大量字符串</h2><p>有些人会使用protobuf存储大量字符串，更有甚者可能会将json放入protobuf中。<br>如果有心人看过protobuf序列化之后的数据，会发现protobuf对字符串数据是直接拷贝的。所以使用protobuf存储字符串，并没有达到优化空间的目的。</p>
<h2 id="二进制数据不需要加密"><a href="#二进制数据不需要加密" class="headerlink" title="二进制数据不需要加密"></a>二进制数据不需要加密</h2><p>既然protobuf是二进制数据交换格式，那我们还有必要对其进行加密吗？<br>看过protobuf官方文档的人会知道，protobuf存储思路是这样的：对于不同字段，使用了tag来标识，而基本数据类型，使用了ZigZag类型存储，字符串直接拷贝。<br>换句话说，protobuf就类似与代码混淆一样，将字段名用简化后的字段名表示，只是可读性差一点。但里面所有的值都可以算出来。<br>所以如果安全对你的应用来说很重要的话，还是加密吧。</p>
<hr>
<p>本文链接：<a href="http://www.servercoder.com/2018/01/10/protobuf-usages/">http://www.servercoder.com/2018/01/10/protobuf-usages/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/01/03/byte-order/" itemprop="url">
                  我是怎么处理大小端及网络字节序的？
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-01-03T23:00:16+08:00" content="2018-01-03">
              2018-01-03
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/01/03/byte-order/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/01/03/byte-order/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>最开始接触c语言时，总会花很多精力去记各种操作符的优先级。后来才发现，实际开发根本就不用记。自此这么多年，除了加减乘除这种小学生都知道的优先级，我基本都是用括号搞定优先级。</p>
<p>同样，不同语言的字节序都不尽相同，比如c++大部分平台是小端存储的（c++的字节序与处理器有关系，具体大小端与编译器对应关系见参考文档1），java就是采用大端存储，c#似乎是小端存储（c#我写的少，有心人可以帮忙确认下）。在写跨语言或者跨平台的程序时，字节序的转换就不得不考虑了。</p>
<h2 id="大端小端转换"><a href="#大端小端转换" class="headerlink" title="大端小端转换"></a>大端小端转换</h2><p>关于大端小端的由来，可以看看《格列佛游记》，我就不转载了。<br>大端：数据的高位存储在低地址中，低位存储在高地址中。<br>小端：数据的高位存储在高地址中，低位存储在低地址中。</p>
<p>举个例子，数据0x12345678，占4个字节，分别是0x12、0x34、0x56、0x78。假设内存起始地址是0x80000000。<br>对于小端程序来说，0x80000000存放0x78，0x80000001存放0x56，0x80000002存放0x34，0x80000003存放0x12。<br>而对于大端程序来说，0x80000000存放0x12，0x80000001存放0x34，0x80000002存放0x56，0x80000003存放0x78。</p>
<p>这里要说明的是，大小端只对多字节数据类型有影响，对于单字节类型的数组、字符串，并没有什么影响。另外如果是多个多字节数据放在一起，顺序依然不会变，只是每个多字节数据区分大端还是小端罢了。</p>
<p>所以，一般情况下，大小端字节序转换规则如下：</p>
<ol>
<li>单字节数据或数组，不需要转换</li>
<li>少于或等于4字节的长整型，前后互换就行了。</li>
</ol>
<p>还有三种特殊情况：</p>
<ol>
<li>对于8字节的长整型int64来说，并不是前后字节互换，而是先将高32位和低32位互换，然后，将这两个int32内部字节位互换。</li>
<li>对于float类型来说，同样是前后字节对换。</li>
<li>尽管double是8字节的，但是其转换方式和float一样，也是前后字节兑换。</li>
</ol>
<p>具体代码可参考poco，我就不贴出来了，参阅参考文献2。</p>
<h2 id="怎么判断大端还是小端"><a href="#怎么判断大端还是小端" class="headerlink" title="怎么判断大端还是小端"></a>怎么判断大端还是小端</h2><p>可能很多毕业生找工作时都会被问到如何判断当前系统是大端还是小端。知道原理后，实现起来其实很简单。定义一个多字节类型，然后判断不同地址的值，看看高地址存放的是高位数据还是低位数据，就能轻易区分当前是大端还是小端了。</p>
<p>实际工作中，就没必要这样判断了。因为不同平台上大小端是提前就知道的。如果使用poco库，完成可以依赖其Platform.h中的宏定义，里面还包含了我没有见过的平台。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(__ALPHA) || defined(__alpha) || defined(__alpha__) || defined(_M_ALPHA)</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH POCO_ARCH_ALPHA</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_LITTLE_ENDIAN 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(i386) || defined(__i386) || defined(__i386__) || defined(_M_IX86) || defined(EMSCRIPTEN) || defined(__EMSCRIPTEN__)</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH POCO_ARCH_IA32</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_LITTLE_ENDIAN 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(_IA64) || defined(__IA64__) || defined(__ia64__) || defined(__ia64) || defined(_M_IA64)</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH POCO_ARCH_IA64</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">if</span> defined(hpux) || defined(_hpux)</span></div><div class="line">		<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_BIG_ENDIAN 1</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line">		<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_LITTLE_ENDIAN 1</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(__x86_64__) || defined(_M_X64)</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH POCO_ARCH_AMD64</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_LITTLE_ENDIAN 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(__mips__) || defined(__mips) || defined(__MIPS__) || defined(_M_MRX000)</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH POCO_ARCH_MIPS</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">if</span> defined(POCO_OS_FAMILY_WINDOWS)</span></div><div class="line">		<span class="comment">// Is this OK? Supports windows only little endian??</span></div><div class="line">		<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_LITTLE_ENDIAN 1</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">elif</span> defined(__MIPSEB__) || defined(_MIPSEB) || defined(__MIPSEB)</span></div><div class="line">		<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_BIG_ENDIAN 1</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">elif</span> defined(__MIPSEL__) || defined(_MIPSEL) || defined(__MIPSEL)</span></div><div class="line">		<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_LITTLE_ENDIAN 1</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line">		<span class="meta">#<span class="meta-keyword">error</span> <span class="meta-string">"MIPS but neither MIPSEL nor MIPSEB?"</span></span></div><div class="line">	<span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(__hppa) || defined(__hppa__)</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH POCO_ARCH_HPPA</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_BIG_ENDIAN 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(__PPC) || defined(__POWERPC__) || defined(__powerpc) || defined(__PPC__) || \</span></div><div class="line">      defined(__powerpc__) || defined(__ppc__) || defined(__ppc) || defined(_ARCH_PPC) || defined(_M_PPC)</div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH POCO_ARCH_PPC</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">if</span> defined(__BYTE_ORDER__) &amp;&amp; (__BYTE_ORDER__ == __ORDER_LITTLE_ENDIAN__)</span></div><div class="line">		<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_LITTLE_ENDIAN 1</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line">		<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_BIG_ENDIAN 1</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(_POWER) || defined(_ARCH_PWR) || defined(_ARCH_PWR2) || defined(_ARCH_PWR3) || \</span></div><div class="line">      defined(_ARCH_PWR4) || defined(__THW_RS6000)</div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH POCO_ARCH_POWER</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_BIG_ENDIAN 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(__sparc__) || defined(__sparc) || defined(sparc)</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH POCO_ARCH_SPARC</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_BIG_ENDIAN 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(__arm__) || defined(__arm) || defined(ARM) || defined(_ARM_) || defined(__ARM__) || defined(_M_ARM)</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH POCO_ARCH_ARM</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">if</span> defined(__ARMEB__)</span></div><div class="line">		<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_BIG_ENDIAN 1</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line">		<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_LITTLE_ENDIAN 1</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(__arm64__) || defined(__arm64)</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH POCO_ARCH_ARM64</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">if</span> defined(__ARMEB__)</span></div><div class="line">		<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_BIG_ENDIAN 1</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">elif</span> defined(__BYTE_ORDER__) &amp;&amp; defined(__ORDER_BIG_ENDIAN__) &amp;&amp; __BYTE_ORDER__ == __ORDER_BIG_ENDIAN__</span></div><div class="line">		<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_BIG_ENDIAN 1</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line">		<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_LITTLE_ENDIAN 1</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(__m68k__)</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH POCO_ARCH_M68K</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_BIG_ENDIAN 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(__s390__)</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH POCO_ARCH_S390</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_BIG_ENDIAN 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(__sh__) || defined(__sh) || defined(SHx) || defined(_SHX_)</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH POCO_ARCH_SH</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">if</span> defined(__LITTLE_ENDIAN__) || (POCO_OS == POCO_OS_WINDOWS_CE)</span></div><div class="line">		<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_LITTLE_ENDIAN 1</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line">		<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_BIG_ENDIAN 1</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined (nios2) || defined(__nios2) || defined(__nios2__)</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH POCO_ARCH_NIOS2</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">if</span> defined(__nios2_little_endian) || defined(nios2_little_endian) || defined(__nios2_little_endian__)</span></div><div class="line">		<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_LITTLE_ENDIAN 1</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line">		<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_BIG_ENDIAN 1</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(__AARCH64EL__)</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH POCO_ARCH_AARCH64</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_LITTLE_ENDIAN 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">elif</span> defined(__AARCH64EB__)</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH POCO_ARCH_AARCH64</span></div><div class="line">	<span class="meta">#<span class="meta-keyword">define</span> POCO_ARCH_BIG_ENDIAN 1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<h2 id="如何将本地字节序转成网络字节序呢？"><a href="#如何将本地字节序转成网络字节序呢？" class="headerlink" title="如何将本地字节序转成网络字节序呢？"></a>如何将本地字节序转成网络字节序呢？</h2><p>本文最开始我提到，如果我们写代码时，不用考虑当前是大端还是小端，就方便极了。<br>poco同样提供了封装：fromNetwork和toNetwork，可以在ByteOrder.h中找到。如果你的项目中没有使用poco，又不想因为大小端问题引入一个库，那问题也不大，无非就是根据大小端情况封装fromNetwork和toNetwork而已，具体实现就直接参考poco的实现就行了。</p>
<p>参考文档：</p>
<ol>
<li><a href="https://github.com/pocoproject/poco/blob/develop/Foundation/include/Poco/Platform.h#L137" target="_blank" rel="external">https://github.com/pocoproject/poco/blob/develop/Foundation/include/Poco/Platform.h#L137</a></li>
<li><a href="https://github.com/pocoproject/poco/blob/develop/Foundation/include/Poco/ByteOrder.h" target="_blank" rel="external">https://github.com/pocoproject/poco/blob/develop/Foundation/include/Poco/ByteOrder.h</a></li>
</ol>
<hr>
<p>本文链接：<a href="http://www.servercoder.com/2018/01/03/byte-order/">http://www.servercoder.com/2018/01/03/byte-order/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/11/sdk-without-http/" itemprop="url">
                  跨平台开发时，我们为什么不封装http请求的sdk
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-12-11T19:09:42+08:00" content="2017-12-11">
              2017-12-11
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/12/11/sdk-without-http/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/12/11/sdk-without-http/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="为什么要封装sdk"><a href="#为什么要封装sdk" class="headerlink" title="为什么要封装sdk"></a>为什么要封装sdk</h2><p>相信很多开发团队都同时需要开发各种平台的客户端，有android、ios，甚至是pc版客户端。于是，怎么尽可能复用同一套业务代码，成了很多开发讨论的话题。</p>
<p>比如，开发照片处理软件，核心的处理算法一定都是c++写的，除了计算效率高之外，算法的实现也肯定是很复杂的，不可能每个客户端都用各自编程语言实现一套。这样带来的好处有：</p>
<ol>
<li>代码量更少，开发效率高。</li>
<li>减少了不同语言实现时产生相同bug的可能。</li>
<li>减少了因不同语言开发人员开发水平不一致，出现各种bug的可能。</li>
<li>后期维护更方便。</li>
<li>测试更方便。</li>
</ol>
<p>同样地，当你引入一个新的通信库时，如grpc。它提供了不同语言的实现，java、go、c++。如果每个语言都基于grpc封装一套通信逻辑，意味着每个语言的人都要了解grpc的使用，如果要求高一点，我们对引入的第三方库一定要读懂核心代码，那耗费的时间就更多了。更别说后期维护的时间。</p>
<h2 id="什么时候要封装sdk"><a href="#什么时候要封装sdk" class="headerlink" title="什么时候要封装sdk"></a>什么时候要封装sdk</h2><p>所以，我们到底什么时候该封装sdk呢？我认为出现下面几种情况，你可能就得考虑封装sdk了。</p>
<ol>
<li>业务逻辑复杂，并且多平台客户端都需要。</li>
<li>复杂的算法。</li>
<li>网络通信中间件。比如我上面提到的grpc,还有一些基于tcp数据的封装、发送、解析。</li>
<li>多个项目可能会使用的公共模块。</li>
</ol>
<h2 id="http请求，是否要封装？"><a href="#http请求，是否要封装？" class="headerlink" title="http请求，是否要封装？"></a>http请求，是否要封装？</h2><p>我们常说的一句话，架构设计不能脱离业务。诚然，我们很多时候的技术选型都是在权衡，权衡开发成本，权衡产品状态，权衡现有开发人员的水平等等。有的时候具体问题还是要具体分析。<br>上面说了那么多什么时候要封装sdk。那对于提供http接口的服务，有必要封装sdk吗？<br>我认为如果只是封装http的请求和响应，而不包含其他业务逻辑时，必要性不大，原因如下：</p>
<ol>
<li>如果将http的请求和相应封装成sdk，我们看看是否提高了开发效率。首先确实只有一处公共代码发起http请求和响应，但为此，需要为各个客户端封装接口，以便能调用sdk。比如，c#需要封装托管c++或是提供c语言形式地接口，然后c#在以invoke的方式调用。比如，java和andriod，我们需要封装jni接口。其他语言就更别说了，能间接调用c接口，但都要简单的封装。于是，后期我们每增加一个接口都需要修改sdk，需要修改调用接口。这样做提高效率了吗？有人可能会说，sdk中发起http请求和相应的代码复用了，我减少了开发和维护成本呢。</li>
<li>但不要忘记了，各个语言都有非常成熟且经过充分验证的http client api。也就是说，各个高级开发语言（除了c++）不需要额外的开发精力，我们就能实现稳定的http调用。</li>
<li>对于http服务来说，如果设计人员的水平还行的话，我们不可能需要频繁修改接口，更多的是新增接口。而对于新增接口而言，我们并没有节省什么开发成本。</li>
<li>你能保证你封装的接口一次性交付么？</li>
</ol>
<h2 id="封装sdk可能带来的问题"><a href="#封装sdk可能带来的问题" class="headerlink" title="封装sdk可能带来的问题"></a>封装sdk可能带来的问题</h2><p>再说远一点，并不是说为了增加复用，提高开发效率就一定要封装sdk。如果是服务端开发人员，如果多个项目都包含同一份sdk，一旦该sdk出了问题，就意味着所有相关项目都需要重新升级部署。<br>这个时候就该考虑服务化了，如果该sdk相关逻辑在一个单独的服务里面，我们只需要更新该服务就行，这样相关项目与那段逻辑就实现了解耦。沈剑的这篇文章<a href="https://mp.weixin.qq.com/s/mjWCuYYbFs16esvkwZ-LKw" target="_blank" rel="external">《小小的公共库，大大的耦合，你痛过吗？》</a>，大家可以关注下。</p>
<hr>
<p>本文链接：<a href="http://www.servercoder.com/2017/12/11/sdk-without-http/">http://www.servercoder.com/2017/12/11/sdk-without-http/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars1.githubusercontent.com/u/32269?v=3&s=460"
               alt="码龙" />
          <p class="site-author-name" itemprop="name">码龙</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">5</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/your-user-name" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/your-user-name" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/your-user-name" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://macshuo.com/" title="MacTalk" target="_blank">MacTalk</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">码龙</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  Hosted by 
  <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a>
  备案号 <a href="http://www.miitbeian.gov.cn" style="font-weight: bold">粤ICP备16057637号</a>
</div>


        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i>访问人数<span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i>总访问量<span class="busuanzi-value" id="busuanzi_value_site_pv"></span>次</span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'programer';
      var disqus_identifier = 'index.html';
      var disqus_title = '';
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  



  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });
                            
                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').mousedown(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>

  

  

  

</body>
</html>
